%This script calculates per-subject spatial correlations between runs of activation in
%multiple runs of the same set of parcels. In this case, we use it to check
%localizer 

experiments(1)=struct(...
    'name','langlocSN',...% language localizer 
    'pwd1','/mindhive/evlab/u/Shared/SUBJECTS',...  % path to the data directory
    'pwd2','firstlevel_langlocSN',... % path to the first-level analysis directory for the lang localizer
    'data',{{ ... %These are the subjects who did langloc during the critical session
        '291_FED_20160916a_3T1', ...
        '238_FED_20160916b_3T1', ...
        '343_FED_20160916c_3T1', ...
        '189_FED_20170220b_3T2', ...
        '365_FED_20170224a_3T2', ...
        '550_FED_20170228c_3T2', ...
        '296_FED_20170301a_3T2', ...
        '551_FED_20170302b_3T2', ...
        '366_FED_20170313a_3T2', ...
        '524_FED_20170331a_3T2'
        }});
experiments(2)=struct(...
    'name','syntshapes',...% non-lang expt
    'pwd1','/users/evelina9/more_evelina_files/MEGADATA/',...
    'pwd2','firstlevel_syntshapes2',...  % path to the first-level analysis directory for the critical task
    'data',{{}});

localizer_spmfiles={};
for nsub=1:length(experiments(1).data),
    localizer_spmfiles{nsub}=fullfile(experiments(1).pwd1,experiments(1).data{nsub},experiments(1).pwd2,'SPM.mat');
end

effectofinterest_spmfiles={};
for nsub=1:length(experiments(1).data),
    effectofinterest_spmfiles{nsub}=fullfile(experiments(1).pwd1,experiments(1).data{nsub},experiments(1).pwd2,'SPM.mat');
end

bcc=struct(...
    'swd','/mindhive/evlab/u/mekline/Documents/Projects/Jokes_Study2/Jokes_Replication_Repo/spcorr_results',...   % output directory
    'EffectOfInterest1_spm',{effectofinterest_spmfiles},...
    'EffectOfInterest2_spm',{localizer_spmfiles},...
    'EffectOfInterest1_contrasts',{{'S','N','S-N'}},...    % contrasts of interest
	'EffectOfInterest2_contrasts',{{'S','N','S-N'}},... % localizer contrast 
    'ManualROIs','/users/evelina9/fMRI_PROJECTS/ROIS/LangParcels_n220_LH.img',...
    'model',1,...                                           % can be 1 (one-sample t-test), 2 (two-sample t-test), or 3 (multiple regression)
    'ask','missing', ...
    'ExplicitMasking', []); % can be 'none' (any missing information is assumed to take default values), 'missing' (any missing information will be asked to the user), 'all' (it will ask for confirmation on each parameter)
bcc=spm_bcc_design(bcc);  % see help spm_ss_design for additional information
bcc=spm_bcc_estimate(bcc);
